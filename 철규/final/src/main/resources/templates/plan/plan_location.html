<html>

<head>
	<meta charset="utf-8">
	<title>갈 곳 정하기</title>

	<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.3.0"></script>

	<style>
		.left_day_set ul {
			text-align: center;
			/* 부모 요소에 수평 중앙 정렬 적용 */
			list-style: none;
			/* 리스트 스타일 제거 */
			margin-top: 0px;
			margin-bottom: 0px;
			width: 100%;
		}


		.left_full_box {
			position: absolute;
			display: flex;
			top: 0px;
			width: 850px;
			height: 100%;

		}

		.left_day_set {
			width: 185px;
			/* 선택할 콘텐츠의 너비 조절 */
			height: 100%;
			background: rgb(32, 51, 65);
			/* 선택할 콘텐츠의 배경색 조절 */
			z-index: 1;
			/* 맵 위에 나타나도록 설정 */
			overflow-y: auto;
			/* 내용이 많을 경우 스크롤 허용 */

			/* 내용과 테두리 사이의 여백 조절 */

		}

		.schedule_full_box {
			display: none;
			/* 선택할 콘텐츠의 너비 조절 */
			height: 100%;
			background-color: #fff;
			/* 선택할 콘텐츠의 배경색 조절 */
			z-index: 1;
			/* 맵 위에 나타나도록 설정 */
			overflow-y: auto;
			/* 내용이 많을 경우 스크롤 허용 */
			border-right: solid #a9a9a9 1px;

			width: 280px;

			flex-direction: column;
			align-items: center;
		}



		.pn_date {

			width: 100%;
			height: 50px;
			line-height: 50px;
			background: #203341;
			color: #fff;
			text-align: center;
			border-bottom: solid 1px #374854;
			font-size: 12px;
			cursor: pointer;

		}

		.cat_menu li {
			width: 100%;
			height: 70px;
			background: #203341;
			color: #fff;
			text-align: center;
			border-bottom: solid 1px #374854;
			font-size: 12px;
			cursor: pointer;
		}

		.title_box {
			width: 100%;
			background: #707070;
			color: #fff;
			line-height: 50px;
			font-size: 15px;
			font-weight: bold;
			height: 50px;
		}


		#day_optimize_btn {
			width: 240px;
			height: 30px;
			text-align: center;
			line-height: 30px;
			border: solid #3099dd 1px;
			margin-left: 10px;
			cursor: pointer;
			background: #49b2e9;
			color: #fff;
			margin: 10 0 10 0;
		}

		#city_list {
			flex-direction: column;
			display: none;
			/* 선택할 콘텐츠의 너비 조절 */
			height: 100%;
			background-color: #fff;
			/* 선택할 콘텐츠의 배경색 조절 */
			z-index: 1;
			/* 맵 위에 나타나도록 설정 */
			overflow-y: auto;
			/* 내용이 많을 경우 스크롤 허용 */

		}

		#detail_view_full_box {

			display: none;
			/* 선택할 콘텐츠의 너비 조절 */
			height: 100%;
			background-color: #fff;
			/* 선택할 콘텐츠의 배경색 조절 */
			z-index: 10;


			/* 내용이 많을 경우 스크롤 허용 */
			position: absolute;
			top: 0px;
			flex-direction: column;
			align-items: center;
			width: 400px;
			left: 467px;
		}






		.list_title {
			width: 100%;
			height: 50px;
			background: #1a7ad9;
			line-height: 50px;
			color: #fff;
			font-size: 15px;
			font-weight: bold;
		}

		.list_title_option_menu {
			position: absolute;
			font-size: 12px;
			color: #fff;
			top: 12px;
			right: 15px;
			font-weight: normal;
			cursor: pointer;
			width: 76px;
			height: 26px;
			line-height: 26px;
			text-align: center;
			border: solid 1px #fff;
			background: url(/https://www.earthtory.com/res/img/workspace/w_arrow_down.png)no-repeat 62px 10px;
			padding-right: 6px;
		}

		.list_search_box {
			width: 100%;
			height: 65px;
			border-bottom: solid #dadada 1px;
			padding-top: 10px;
			background: #fff;
			text-align: center;
		}

		#input_search {
			margin-top: 5px;
			width: 328px;
			height: 31px;
			border: solid #c8c8ca 1px;
			padding-left: 5px;
			font-family: 'nanum';
			background: url(https://www.earthtory.com/res/img/common/gnb/search_icon.png) no-repeat;
			background-position: 300px 4px
		}

		.list_cat_item {
			width: 68px;
			padding-left: 7px;
			cursor: pointer;


		}

		#map_tag_select_box {
			width: 318px;
			height: 31px;
			background: #fff url(https://www.earthtory.com/res/img/flight/drop_select_arrow_a.png) no-repeat 300px 12px;
			line-height: 31px;
			margin: 0 auto;
			margin-top: 5px;
			padding-left: 5px;
			font-size: 13px;
			margin-left: 23.500;
			color: #808080;
			cursor: pointer;
			float: left;

		}

		#map_tag_select_sub_box {
			width: 301.979px;
			padding: 10px;
			border: solid 1px #c8c8ca;
			border-top: none;
			background: #fff;
			padding-bottom: 3px;
			max-height: 252px;
			overflow-y: auto;
			margin-left: 24px;
			z-index: 8;
			top: 38px
		}

		#map_tag_select_sub_box .item {
			cursor: pointer;
			margin-bottom: 5px;
		}



		.day_spot_item {
			cursor: move;
			border-bottom: solid #a7a7a7 1px;
			background: #fff;
			position: relative;
			display: flex;
			padding: 15px;


		}

		.day_spot_item:hover .item_contr_box {
			display: block;
		}



		.spot_order_box {
			width: 19px;
			height: 19px;
			border-radius: 9px;
			position: absolute;
			left: 12px;
			top: 20px;
			background: #223b68;
			line-height: 19px;
			text-align: center;
			color: white;
			font-size: 11px;

		}

		#schedule_detail_box .day_spot_item:nth-child(2) .spot_distance_box {
			display: none;
		}

		#schedule_detail_box .day_spot_item:nth-child(2) {
			border-top: solid #a7a7a7 1px;


		}

		.spot_distance_box {
			height: 21px;
			line-height: 21px;
			background: #fff;
			border: solid #cacaca 1px;
			font-size: 11px;
			color: #808080;
			position: absolute;
			padding: 0px 5px;
			margin-top: -25px;
			cursor: pointer;
		}

		.cat_date_left_day {
			box-sizing: border-box;
			float: left;
			margin-top: 14px;
			margin-left: 26px;

		}

		.cat_date_left_day .cat_left_day {
			font-size: 21px;
			font-weight: bold;
		}

		.cat_date_left_day .cat_left_date {
			color: #49b2e9;
		}

		.cat_date_right_day {
			box-sizing: border-box;
			float: left;
			margin-top: 21px;
			margin-left: 12px;

		}

		.cat_date_right_day .cat_right_city {
			margin-top: 3px;
			color: #b3b3b3;
			text-align: left !important;

		}

		.left_day_set_on {
			background: #1a7ad9 !important;
			border-bottom: solid 1px #1a7ad9 !important;
		}

		.list_title_location {
			font-size: 18px;
			margin-left: 30px;
		}

		.sub_title {
			font-size: 12px;
			color: #808080;
			padding-top: 8px;
		}
	</style>
</head>

<body style="margin : 0px;">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
	<script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.min.js"></script>





	<div class="in_modal_full_frame"
		style="width: 100%;height: 2000px;position: absolute;top: 0px;left: 0px;background: url(https://www.earthtory.com/res/img/component/bg/bgb_70.png) repeat;z-index: 1000;display: none;">

		<div class="modal_for_short"
			style="display:none;width: 468px;height: 257px;background: #fff;margin: 0 auto;margin-top: 150px;">
			<div class="modal_title_box"
				style="width: 100%;height: 60px;line-height: 60px;border-bottom: 1px solid #b3b3b3;font-size: 20px;color: #363636;padding-left: 13px;overflow: hidden;">
				경로 최적화<img style="float: right;"
					src="https://www.earthtory.com/res/img/modal/common/modal_close_btn.gif" onclick="modal_close()">
			</div>
			<div class="in_modal_content"
				style="width: 100%;padding-left: 20px;padding-right: 20px;padding-top: 20px; height: 92px;">
				<div class="in_modal_item_title" style="float: left;height: 31px;line-height: 31px;width: 100px ">첫번째 장소
				</div>
				<div class="in_modal_title" style="float: left;position:relative;">
					<div id="opti_start_point" data_is_open="0" onclick="opti_start_open(this)"
						style="width: 318px;height: 31px;border: solid #c8c8ca 1px;color: #808080;font-size: 13px;padding-left: 12px;line-height: 31px;cursor: pointer;background: #fff url(https://www.earthtory.com/res/img/flight/drop_select_arrow_a.png) no-repeat 300px 12px;">

					</div>
					<div id="opti_start_point_box"
						style="display:none;position: absolute;width: 318px;padding: 10px;border: solid 1px #c8c8ca;background: #fff;padding-bottom: 3px;max-height: 252px;overflow-y: auto;margin-top: -1px;z-index: 9;">

					</div>
				</div>
				<div class="clear" stlye="padding-top: 10px "></div>
				<div class="in_modal_item_title" style="float: left;height: 31px;line-height: 31px;width: 100px">마지막 장소
				</div>
				<div class="in_modal_title" style="float: left;position:relative;">
					<div id="opti_end_point" data_is_open="0" onclick="opti_end_open(this)"
						style="width: 318px;height: 31px;border: solid #c8c8ca 1px;color: #808080;font-size: 13px;padding-left: 12px;line-height: 31px;cursor: pointer;background: #fff url(https://www.earthtory.com/res/img/flight/drop_select_arrow_a.png) no-repeat 300px 12px; ">
					</div>
					<div id="opti_end_point_box"
						style="display:none;width: 318px;padding: 10px;border: solid 1px #c8c8ca;background: #fff;padding-bottom: 3px;max-height: 252px;overflow-y: auto;margin-top: -1px;z-index: 9;">

					</div>
				</div>
				<div class="clear" style="padding-top: 20px "></div>
			</div>
			<div class="in_modal_footer"
				style="width: 100%;border-top: 1px solid #b3b3b3;padding-top: 20px;padding-bottom: 20px;text-align: center;">
				<div class="in_modal_ok_btn" onclick="optimize_route_go()"
					style="width: 145px;height: 42px;background: #ff9320;border: solid #f7870f 1px;cursor: pointer;line-height: 42px;color: #fff;font-size: 15px;font-weight: bold;margin: 0 auto;">
					완료</div>
			</div>
		</div>

		<div id="modal_short_show"
			style="width: 729px;min-height: 534px;background: #fff;margin: 0 auto;margin-top: 150px;display: none;position: relative;">
			<div class="in_modal_content"
				style="background:#f3f3f3;width: 100%;padding-left: 20px;padding-right: 20px;padding-top: 20px;">

				<div class="in_modal_title_box"
					style="width: 100%;height: 60px;line-height: 60px;border-bottom: 1px solid #b3b3b3;font-size: 20px;color: #363636;padding-left: 13px;overflow: hidden;">
					경로 최적화 <img style="float: right;"
						src="https://www.earthtory.com/res/img/modal/common/modal_close_btn.gif"></div>
				<div class="opti_before_box"
					style="width: 323px;min-height: 360px;border: solid #d8d8d8 1px;background: #fff; float: left;">

				</div>
				<div style="padding: 10px;padding-top: 150px;float: left;"><img
						src="https://www.earthtory.com/res/img/workspace/opti_before_after_arrow.png"></div>
				<div class="opti_after_box"
					style="width: 323px;min-height: 360px;border: solid #d8d8d8 1px;background: #fff;float: left;">

				</div>
				<div class="clear" style="padding-top:20px;"></div>
			</div>
			<div class="in_modal_footer"
				style="width: 100%;border-top: 1px solid #b3b3b3;padding-top: 20px;padding-bottom: 20px;text-align: center;">
				<div class="in_modal_ok_btn"
					style="width: 145px;height: 42px;background: #ff9320;border: solid #f7870f 1px;cursor: pointer;line-height: 42px;color: #fff;font-size: 15px;font-weight: bold;margin: 0 auto;">
					완료</div>
			</div>
		</div>


	</div>

	<div id="map_city" style="flex:1;height:100%;">

		<div id="map" style="position: relative;height:100%;"></div>




	</div>

	<div class="left_full_box" style="z-index: 1;">
		<div class="left_day_set" style="z-index: 1;">

			<ul class="pn_title_box" style="background: #203341; padding-left: 0px; ">
				<li class="pn_date">
					<div class="full_date_info" style="display:inline-block; font-size:13px;"></div>
					<div class="fl day_edit_start_btn"
						style="display:inline-block;margin-top: 18px;margin-left: 10px;background: url(https://www.earthtory.com/res/img/workspace/new/cat_set_icon.png) no-repeat;padding-left: 18px;line-height: 15px;">
						EDIT</div>
				</li>

			</ul>
			<ul class="cat_menu" id="cat_menu"
				style="position:relative;background: #203341;overflow-y: auto;padding-left: 0px;">
				<li id="show_all_day" style="line-height: 70px;font-size: 15px !important;">전체 일정 보기</li>

			</ul>
			<ul id="cat_add_box"
				style="flex:1; padding-left : 0px; background: rgb(32, 51, 65); color: rgb(255, 255, 255);  text-align: center;">
				<li style="padding-top:15px; ">
					<div style="width:124px;height:32px;line-height:32px;border:solid 1px #fff;text-align:center;margin:0 auto;cursor:pointer;"
						onclick="add_plan_day()">Day 추가</div>
				</li>
			</ul>
		</div>

		<div class="schedule_full_box">
			<div class="title_box" id="title_box">

			</div>
			<div id="day_controll_btn_box">
				<div id="day_optimize_btn" onclick="loc_optimize_btn()">경로 최적화</div>
			</div>
			<div id="schedule_detail_box" style="height: 738px; width:100%;">

			</div>
		</div>



		<div id="city_list">
			<div class="list_title">


			</div>
			<div class="list_search_full_box">
				<div class="list_search_box">
					<input type="text" id="input_search" oninput="search_keyword(this)"
						onchange="search_keyword_check(this)" autocomplete='off' placeholder="키워드 검색">

				</div>
				<div class="list_category_box"
					style="background: #f7f7f7;height: 120px;padding-top: 8px;padding-right:5px;display: flex;">

					<!--음식점-->
					<div class="list_cat_item" contenttype_id="39" onclick="item_contenttype(this)"><img
							src="http://localhost:8080/img/baby-cutlery.png"></div>
					<!--쇼핑-->
					<div class="list_cat_item" contenttype_id="38" onclick="item_contenttype(this)"><img
							src="http://localhost:8080/img/shopping.png"></div>
					<!--숙박-->
					<div class="list_cat_item" contenttype_id="32" onclick="item_contenttype(this)"><img
							src="http://localhost:8080/img/accomodation.png"></div>
					<!--관광지-->
					<div class="list_cat_item" contenttype_id="12" onclick="item_contenttype(this)"><img
							src="http://localhost:8080/img/camera.png"></div>
					<!--문화시설-->
					<div class="list_cat_item" contenttype_id="14" onclick="item_contenttype(this)"><img
							src="http://localhost:8080/img/art-gallery.png"></div>
					<!--레포츠
					<div class="list_cat_item" contenttype_id="28" onclick="item_contenttype(this)"><img
							src="http://localhost:8080/img/sports.png"></div>-->


				</div>
				<div class="list_tag_box" style="position: relative;display: flex;">
					<div class="map_tag_wrap" style="position: relative;">
						<div id="map_tag_select_box" onclick="open_sub_box(this)" data_is_open="0"
							class="et_slide_parent" style="border: 1px solid  #c8c8ca;">태그 선택</div>
						<div id="map_tag_select_sub_box" class="et_slide" style="display:none; position: absolute;">

						</div>
					</div>
				</div>

			</div>


			<div id="list_box" style="flex: 1; overflow-y: auto;">

			</div>
		</div>
		<div id="detail_view_full_box" class="detail_view_full_box"></div>



	</div>









	<script type="text/javascript"
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=362b656b5b93008aab3b5504dea7f99d&libraries=services"></script>




	<script type='text/javascript' th:inline="javascript">

		var map;

		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
			mapOption = {
				center: new kakao.maps.LatLng(37.715133, 126.734086), // 지도의 중심좌표
				level: 8 // 지도의 확대 레벨
			};
		map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다


		window.onload = () => {
			left_day_set();
			 $('#cat_menu li:eq(1)').trigger('click');
			// 함수 호출
			//drawRoute(routeData);












		}






		var start_sub;
		var end_sub;
		var start = new Date(/*[[${start}]]*/ null);
		var end = new Date(/*[[${end}]]*/ null);
		var start_day_Nu = parseInt(/*[[${start_day}]]*/ null);
		var check_day = 1;
		var By_day = [];
		function left_day_set() {
			var set_daylist =  /*[[${set_daylist}]]*/[];
			start_sub = start.toLocaleDateString('ko-KR', {month: '2-digit', day: '2-digit'}).replace(/\//g, '-').replace('.', '-').replace(/\.+$/, '');
			end_sub = end.toLocaleDateString('ko-KR', {month: '2-digit', day: '2-digit'}).replace(/\//g, '-').replace('.', '-').replace(/\.+$/, '');


			$(".full_date_info").text(start_sub + " ~ " + end_sub);

			start.setDate(start.getDate() - 1);

			for (var item of set_daylist) {
				for (var i = 0; i < parseInt(item.day); i++) {

					start.setDate(start.getDate() + 1);
					start_day = start.toLocaleDateString('ko-KR', {month: '2-digit', day: '2-digit'}).replace(/\//g, '-').replace('.', '-').replace(/\.+$/, '');

					var div = $(
						`<li  day_Ko="` + change_N_to_Day() + `" check_day = "` + check_day + `" data-date="` + start_day + `" data-f_lat="` + item.lat + `" data-f_lng="` + item.lng + `" original-title="` + item.location + `" onclick="open_right_box(this),open_city(this),focus_change(this)">
							<div class="cat_date_left_day">
								<div class="cat_left_day">DAY`+ check_day + `</div>
								<div class="cat_left_date">`+ start_day + `</div>
							</div>
							<div class="cat_date_right_day">
								<div class="cat_right_weekday">`+ change_N_to_Day() + `</div>
								<div class="cat_right_city">`+ item.location + `</div>
							</div>
						</li>`


					)
					$('#cat_menu').append(div);
					var By_day_array = {'name': 'Day' + check_day, 'value': [change_N_to_Day(), item.lat, item.lng, item.location, start_day]};
					By_day.push(By_day_array);
					By_day[parseInt(check_day) - 1][0] = [];
					check_day++;
					start_day_Nu++;
				}

			}





		}



		function add_plan_day() {
			start.setDate(start.getDate() + 1);
			end.setDate(end.getDate() + 1);
			var lat;
			var lng;
			var location;


			start_add_day = start.toLocaleDateString('ko-KR', {month: '2-digit', day: '2-digit'}).replace(/\//g, '-').replace('.', '-').replace(/\.+$/, '');
			end_add_day = start.toLocaleDateString('ko-KR', {month: '2-digit', day: '2-digit'}).replace(/\//g, '-').replace('.', '-').replace(/\.+$/, '');
			var add_div = $(
				`<li day_Ko="` + change_N_to_Day() + `" check_day = "` + check_day + ` "data-date="` + start_add_day + `" data-f_lat="" data-f_lng="" original-title="" onclick="open_right_box(this),focus_change(this)">
							<div class="cat_date_left_day">
								<div class="cat_left_day">DAY`+ check_day + `</div>
								<div class="cat_left_date">`+ start_add_day + `</div>
							</div>
							<div class="cat_date_right_day">
								<div class="cat_right_weekday">`+ change_N_to_Day() + `</div>
								<div class="cat_right_city"></div>
							</div>
						</li>`


			)
			$('#cat_menu').append(add_div);
			var By_day_array = {'name': 'Day' + check_day, 'value': [change_N_to_Day(), lat, lng, location, start_add_day]};
			By_day.push(By_day_array);
			By_day[parseInt(check_day) - 1][0] = [];
			check_day++;
			start_day_Nu++;

			$(".full_date_info").text(start_sub + " ~ " + end_add_day);
		}




		function change_N_to_Day() {

			if (start_day_Nu > 6) {
				start_day_Nu = 0

			}
			var N_to_Day = {
				'0': '일요일',
				'1': '월요일',
				'2': '화요일',
				'3': '수요일',
				'4': '목요일',
				'5': '금요일',
				'6': '토요일'
			};

			return N_to_Day[start_day_Nu]

		}

		var natural_change = {
			'A0101': '자연관광지',
			'A01010100': '국립공원',
			'A01010200': '도립공원',
			'A01010300': '군립공원',
			'A01010400': '산',
			'A01010500': '자연생태관광지',
			'A01010600': '자연휴양림',
			'A01010700': '수목원',
			'A01010800': '폭포',
			'A01010900': '계곡',
			'A01011000': '약수터',
			'A01011100': '해안절경',
			'A01011200': '해수욕장',
			'A01011300': '섬',
			'A01011400': '항구/포구',
			'A01011600': '등대',
			'A01011700': '호수',
			'A01011800': '강',
			'A01011900': '동굴',
			'A0102': '관광자원',
			'A01020100': '희귀동.식물',
			'A01020200': '기암괴석'
		};

		var tour_change = {
			'A0201': '역사관광지',
			'A02010100': '고궁',
			'A02010200': '성',
			'A02010300': '문',
			'A02010400': '고택',
			'A02010500': '생가',
			'A02010600': '민속마을',
			'A02010700': '유적지/사적지',
			'A02010800': '사찰',
			'A02010900': '종교성지',
			'A02011000': '안보관광',
			'A0202': '휴양관광지',
			'A02020200': '관광단지',
			'A02020300': '온천/욕장/스파',
			'A02020400': '이색찜질방',
			'A02020500': '헬스투어',
			'A02020600': '테마공원',
			'A02020700': '공원',
			'A02020800': '유람선/잠수함관광',
			'A0203': '체험관광지',
			'A02030100': '농.산.어촌 체험',
			'A02030200': '전통체험',
			'A02030300': '산사체험',
			'A02030400': '이색체험',
			'A02030600': '이색거리',
			'A0204': '산업관광지',
			'A02040400': '발전소',
			'A02040600': '식음료',
			'A02040800': '발전소',
			'A02040400': '기타',
			'A02040900': '전자-반도체',
			'A02041000': '자동차',
			'A0205': '건축/조형물',
			'A02050100': '다리/대교',
			'A02050200': '기념탑/기념비/전망대',
			'A02050300': '분수',
			'A02050400': '동상',
			'A02050500': '터널',
			'A02050600': '유명건물'

		};

		var culture_change = {
			'A0206': '문화시설',
			'A02060100': '박물관',
			'A02060200': '기념관',
			'A02060300': '전시관',
			'A02060400': '컨벤션센터',
			'A02060500': '미술관/화랑',
			'A02060600': '공연장',
			'A02060700': '문화원',
			'A02060800': '외국문화원',
			'A02060900': '도서관',
			'A02061000': '대형서점',
			'A02061100': '문화전수시설',
			'A02061200': '영화관',
			'A02061300': '어학당',
			'A02061400': '학교',
			'A0207': '축제',
			'A02070100': '문화관광축제',
			'A02070200': '일반축제',
			'A0208': '공연/행사',
			'A02080100': '전통공연',
			'A02080200': '연극',
			'A02080300': '뮤지컬',
			'A02080400': '오페라',
			'A02080500': '전시회',
			'A02080600': '박람회',
			'A02080800': '무용',
			'A02080900': '클래식음악회',
			'A02081000': '대중콘서트',
			'A02081100': '영화',
			'A02081200': '스포츠경기',
			'A02081300': '기타행사'

		};

		var shopping_change = {
			'A0401': '쇼핑',
			'A04010100': '5일장',
			'A04010200': '상설시장',
			'A04010300': '백화점',
			'A04010400': '면세점',
			'A04010500': '대형마트',
			'A04010600': '전문매장/상가',
			'A04010700': '공예/공방',
			'A04010900': '특산물판매점',
			'A04011000': '사후면세점'
		}

		var food_change = {
			'A0502': '음식점',
			'A05020100': '한식',
			'A05020200': '서양식',
			'A05020300': '일식',
			'A05020400': '중식',
			'A05020700': '이색음식점',
			'A05020900': '카페/전통찻집',
			'A05021000': '클럽'

		}
		var house_change = {
			'B0201': '숙박시설',
			'B02010100': '관광호텔',
			'B02010500': '콘도',
			'B02010600': '유스호스텔',
			'B02010700': '펜션',
			'B02010900': '모텔',
			'B02011000': '민박',
			'B02011100': '게스트하우스',
			'B02011200': '홈스테이',
			'B02011300': '서비스드레지던스',
			'B02011600': '한옥'

		}



		function open_right_box(e) {
			$('.schedule_full_box').css('display', 'flex');
			//check_day, change_N_to_Day(), item.lat, item.lng, item.location, start_day
			var data = $(e).attr("check_day");
			var date = $(e).attr("data-date");
			var day_Ko = $(e).attr("day_Ko");

			$('#title_box').empty();
			var schedule_make = $(
				`<div class="schedule_detail_title" data-date="` + date + `"  style="display:flex;">
				 <div class="schedule_detail_title_text" style="width:150px;padding-left:10px;font-size:15px;float:left;">
					 <div class="schedule_detail_title_text_text" style="width: 154px;">
						 Day`+ data + `  <span style="color:#999999">|</span> <span>` + date + `(` + day_Ko + `)</span>
						 
					 </div>
				 </div>
				 <div class="day_reset_btn" onlick="day_reset_btn(this)" style=" width: 20px;height: 20px;background: url(https://www.earthtory.com/res/img/workspace/_day_reset_icon.png) no-repeat;background-size: 20px 20px;margin-top:15px;margin-left: 10px;margin-bottom:3.8;cursor: pointer;"></div>
				 
			 </div>`
			)
			$('#title_box').append(schedule_make);
			//div class="day_prev_btn" onlick="day_prev_btn(this)" style=" margin-left:13px;display:inline-block; width: 22px;height: 24px;border: solid #fff 1px;background: url(https://www.earthtory.com/res/img/workspace/_prev_icon.png) no-repeat 6px 6px;margin-top: 13px;cursor: pointer;"></div>
			//div class="day_next_btn" onlick="day_next_btn(this)" style="display:inline-block; width: 22px;height: 24px;border: solid #fff 1px;background: url(https://www.earthtory.com/res/img/workspace/_next_icon.png) no-repeat 6px 6px;margin-top: 13px;cursor: pointer;"></div>
			
			
			
			//[parseInt(data_check)-1]
			//console.log(By_day[parseInt(data) - 1][0])

			var empty = $(`	<div class="tip_box" style="padding-bottom: 20px;text-align: center;padding-top: 20px;">
						<img src="https://www.earthtory.com/res/img/workspace/tip_ko.png">
					</div>`)
			$('#schedule_detail_box').html(empty);


			if (By_day[parseInt(data) - 1][0].length > 1) {
				previousMarker = null; // 이전 마커
				pre_previousMarker = null;
				totalDistance = 0; // 누적 거리
				markers = []; // 마커를 담을 배열
				lines = []; // 폴리라인을 담을 배열
				map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
				$('.tip_box').hide();
				for (var i = 0; i < By_day[parseInt(data) - 1][0].length; i++) {
					console.log(By_day[parseInt(data) - 1][0][i]);
					var title = By_day[parseInt(data) - 1][0][i].value[2];
					var image = By_day[parseInt(data) - 1][0][i].value[10];
					var cat2_Ko = By_day[parseInt(data) - 1][0][i].value[3];
					var cat3_Ko = By_day[parseInt(data) - 1][0][i].value[4];
					var cat2 = By_day[parseInt(data) - 1][0][i].value[5];
					var cat3 = By_day[parseInt(data) - 1][0][i].value[6];
					var mapx = By_day[parseInt(data) - 1][0][i].value[7];
					var mapy = By_day[parseInt(data) - 1][0][i].value[8];
					var contentid = By_day[parseInt(data) - 1][0][i].value[9];
					var check_for_up = By_day[parseInt(data) - 1][0][i].value[1];
					var check_day = By_day[parseInt(data) - 1][0][i].value[0];
					var latlng = new kakao.maps.LatLng(mapy, mapx);
					var distance_is = addMarker(latlng);
					var schedule_box = $(`<div class="day_spot_item" data_check=` + check_day + ` title="` + title + `" mapx="` + mapx + `" mapy="` + mapy + `">
					<div class="spot_distance_box spot_distance_box`+ check_for_up + `" pre_title="` + pre_title + `" title="` + title + `" mapy="` + mapy + `"   mapx="` + mapx + `" distance_is ="` + distance_is + `"  onclick="openKakaoMap(this)" >` + distance_is + `추천 경로</div>
					<div class="img_box" style="margin-top: 10px">
						<div class="spot_order_box">`+ (check_day) + `</div>
						<img src="`+ image + `" style="width: 82px;height: 75px;">
						<div style="position:absolute;top:80px;left:75px;width:22px;height:20px;">
	    				<img src="https://www.earthtory.com/res/img/workspace/list_memo_btn_off.png" style="width:22px;height:20px;">
						</div>
					</div>
					<div class="info_box" style="padding-left: 10px;width: 153px; margin-top: 10px">
						<div class="title" >`+ title + `</div>
						<div class="sub"  style="    font-size: 12px;color: #808080;padding-top: 8px;">`+ cat2_Ko + `,` + cat3_Ko + `</div>
					</div>
					<div class="item_contr_box" style="display:block">
						<div class="item_set_plan" title="메모&예산"  title_real = "`+ title + `" contentid ="` + contentid + `" onclick="detail_view(this)"><img src="https://www.earthtory.com/res/img/workspace/new/item_set_icon_a.png"></div>
						<div class="btn_del" check_day = "`+ data + `" mapx="` + mapx + `" mapy = "` + mapy + `" data_check=` + By_day[parseInt(data) - 1][0].length + ` check_for_up="` + check_for_up + `" onclick="del_add_box(this)"><img src="https://www.earthtory.com/res/img/workspace/new/item_del_icon_a.png"></div>
					</div>
				</div>`);
					$('#schedule_detail_box').append(schedule_box);
					pre_title = title;
				}
			} else {

				previousMarker = null; // 이전 마커
				pre_previousMarker = null;
				totalDistance = 0; // 누적 거리
				markers = []; // 마커를 담을 배열
				lines = []; // 폴리라인을 담을 배열
				map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다


			}


		}
		
		
		
		

		var pre_title;
		var check_for_up = 0;

		function add_detail_box(e) {
			var check_day = $('.left_day_set_on').attr("check_day")
			var title = $(e).attr("title");
			var image = $(e).attr("image");
			var cat2_Ko = $(e).attr("cat2_Ko");
			var cat3_Ko = $(e).attr("cat3_Ko");
			var cat2 = $(e).attr("cat2");
			var cat3 = $(e).attr("cat3");
			var mapx = $(e).attr("mapx");
			var mapy = $(e).attr("mapy");
			var contentid = $(e).attr("contentid");
			check_for_up++;
			var data_set_day = $('.schedule_detail_title_text_text').text();
			$('.tip_box').hide();



			By_day[parseInt(check_day) - 1][0].push({name: 'Detail' + (By_day[parseInt(check_day) - 1][0].length + 1), 'value': [(By_day[parseInt(check_day) - 1][0].length + 1), check_for_up, title, cat2_Ko, cat3_Ko, cat2, cat3, mapx, mapy, contentid, image]}); // 해당 요소의 value 배열에 값을 추가합니다.

			var latlng = new kakao.maps.LatLng(mapy, mapx);
			var distance_is = addMarker(latlng);
			var day_spot = $(
				`<div class="day_spot_item  day_spot_item` + check_for_up + `" data_check=` + By_day[parseInt(check_day) - 1][0].length + ` data_set_day="` + data_set_day + `" title="` + title + `" mapx="` + mapx + `" mapy="` + mapy + `">
					<div class="spot_distance_box spot_distance_box`+ check_for_up + `" pre_title="` + pre_title + `" title="` + title + `" mapy="` + mapy + `"   mapx="` + mapx + `" distance_is ="` + distance_is + `"  onclick="openKakaoMap(this)" >` + distance_is + `추천 경로</div>
					<div class="img_box" style="margin-top: 10px">
						<div class="spot_order_box">`+ (By_day[parseInt(check_day) - 1][0].length) + `</div>
						<img src="`+ image + `" style="width: 82px;height: 75px;">
						<div style="position:absolute;top:80px;left:75px;width:22px;height:20px;">
	    				<img src="https://www.earthtory.com/res/img/workspace/list_memo_btn_off.png" style="width:22px;height:20px;">
						</div>
					</div>
					<div class="info_box" style="padding-left: 10px;width: 153px; margin-top: 10px">
						<div class="title" >`+ title + `</div>
						<div class="sub"  style="    font-size: 12px;color: #808080;padding-top: 8px;">`+ cat2_Ko + `,` + cat3_Ko + `</div>
					</div>
					<div class="item_contr_box" style="display:block">
						<div class="item_set_plan" title="메모&예산"  title_real = "`+ title + `" contentid ="` + contentid + `" onclick="detail_view(this)"><img src="https://www.earthtory.com/res/img/workspace/new/item_set_icon_a.png"></div>
						<div class="btn_del"  check_day = "`+ check_day + `" mapx="` + mapx + `" mapy = "` + mapy + `" data_check=` + By_day[parseInt(check_day) - 1][0].length + ` check_for_up="` + check_for_up + `" onclick="del_add_box(this)"><img src="https://www.earthtory.com/res/img/workspace/new/item_del_icon_a.png"></div>
					</div>
				</div>`
			)
			$('#schedule_detail_box').append(day_spot);
			//$('#schedule_detail_box').children().eq(data_check).find('.spot_order_box').val(data_check);

			pre_title = title;


		}


		function del_add_box(e) {
			var data_checks = $(e).attr("data_check")
			var check_day = $(e).attr("check_day")
			var check_for_up = $(e).attr("check_for_up")
			var mapx = $(e).attr("mapx")
			var mapy = $(e).attr("mapy")
			var index_check = $(e).index();
			$('#schedule_detail_box [data_check="' + data_checks + '"]').remove();
			By_day[parseInt(check_day) - 1][0].splice((parseInt(data_checks) - 1), 1)
			console.log(By_day[parseInt(check_day) - 1][0]);

			var latlng_in = new kakao.maps.LatLng(mapx, mapy);
			var targetLat = latlng_in.getLat().toFixed(7); // 삭제할 위치의 위도를 소수점 아래 7자리까지 표시
			var targetLng = latlng_in.getLng().toFixed(7); // 삭제할 위치의 경도를 소수점 아래 7자리까지 표시
			$('#schedule_detail_box').children().each(function (index) {
				$(this).find('.spot_order_box').text(index);
				$(this).find('.btn_del').attr('data_check', index);
				$(this).attr('data_check', index);
			});



			for (var i = 0; i < markers.length; i++) {



				var markerLat = markers[i].getPosition().getLat().toFixed(7); // 마커의 위도를 소수점 아래 7자리까지 표시
				var markerLng = markers[i].getPosition().getLng().toFixed(7); // 마커의 경도를 소수점 아래 7자리까지 표시



				if (markerLat === targetLng && markerLng === targetLat) { // 마커의 위치를 비교합니다.
					console.log("하위")
					markers[i].setMap(null); // 마커를 지도에서 제거합니다.
					markers.splice(i, 1); // 배열에서 해당 마커를 제거합니다.
					redrawMap(check_for_up, data_checks);


					break;
				}
			}



		}

		function redrawMap(check_for_up, data_checks) {
			// 이전 지도 객체를 제거합니다.
			//	map.delete();

			// 새로운 지도 객체를 생성합니다.


			map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
			// 남아있는 마커들을 다시 지도에 표시합니다.
			var latling_in;
			for (var i = 0; i < markers.length; i++) {
				markers[i].setMap(map);
				var markerLat = markers[i].getPosition().getLat().toFixed(7); // 마커의 위도를 소수점 아래 7자리까지 표시
				var markerLng = markers[i].getPosition().getLng().toFixed(7); // 마커의 경도를 소수점 아래 7자리까지 표시
				latlng_in = new kakao.maps.LatLng(markerLat, markerLng);
			}
			map.setCenter(latlng_in);
			//if (parseInt(data_checks) > 1) {

			drawPolyline(check_for_up)
			//}

		}


		function drawPolyline(check_for_up) {

			previousMarker = null; // 이전 마커
			// 폴리라인을 그리기 위한 좌표 배열을 생성합니다.
			var path = [];
			var pre = null;
			var check_check = parseInt(check_for_up) + 1;

			// markers 배열 내의 마커들의 위치를 순차적으로 가져와 좌표 배열에 추가합니다.
			for (var i = 0; i < markers.length; i++) {
				var markerPosition = markers[i];
				path.push(markerPosition.getPosition());

				if (previousMarker !== null) {

					var distance = getLineDistance(previousMarker.getPosition(), markerPosition.getPosition());
					var distancecheck = distance.toFixed(2) + 'km';
					totalDistance += distance;
					$(".spot_distance_box" + check_check).text(distancecheck);

				}

				pre_previousMarker = previousMarker;
				previousMarker = markerPosition;

			}

			// 폴리라인을 생성합니다.
			polyline = new kakao.maps.Polyline({
				path: path,
				strokeWeight: 3,
				strokeColor: '#FF0000',
				strokeOpacity: 0.7,
				strokeStyle: 'arrow'
			});

			// 지도에 폴리라인을 추가합니다.
			polyline.setMap(map);
		}






		function open_city(e) {
			var location = $(e).attr("original-title");
			var city_lat = $(e).attr("data-f_lat");
			var city_lng = $(e).attr("data-f_lng");
			// 지도 중심을 부드럽게 이동시킵니다
			if (city_lat) {

				var moveLatLon = new kakao.maps.LatLng(city_lat, city_lng);
				$('.list_title').empty();
				var list_title = $(
					`<span class="list_title_location">` + location + `</span>
				<div class="list_title_option_menu" style="">도시 변경</div>`
				)
				$(".list_title").append(list_title);

				map.panTo(moveLatLon);
				$('#city_list').css('display', 'flex');





				$.ajax({
					url: '/plan/call_list_box', // 요청을 보낼 URL
					method: "get", // HTTP 메서드 (GET, POST 등)
					data: {
						city_lat: city_lat,
						city_lng: city_lng

					}, // 요청에 포함할 데이터 (선택 사항)
					success: function (list_box) {
						// 요청이 성공한 경우 실행할 코드
						$('#list_box').empty();



						var cat2_Ko;
						var cat3_Ko;
						for (var i = 0; i < list_box.length; i++) {
							var title = list_box[i].title;
							var image = list_box[i].firstimage;
							var cat2 = list_box[i].cat2;
							var cat3 = list_box[i].cat3;
							var mapx = list_box[i].mapx;
							var mapy = list_box[i].mapy;
							var contentid = list_box[i].contentid;
							var contenttypeid = list_box[i].contenttypeid;

							switch (contenttypeid) {
								case '39':
									cat2_Ko = food_change[cat2]
									cat3_Ko = food_change[cat3]
									break;
								case '38':
									cat2_Ko = shopping_change[cat2]
									cat3_Ko = shopping_change[cat3]
									break;

								case '12':
									cat2_Ko = tour_change[cat2]
									cat3_Ko = tour_change[cat3]
									break;

								case '14':
									cat2_Ko = culture_change[cat2]
									cat3_Ko = culture_change[cat3]
									break;

								default:
									cat2_Ko = house_change[cat2]
									cat3_Ko = house_change[cat3]
									break;


							}


							if (cat2_Ko != undefined) {

								var put_box = $(
									`
							<div class="day_spot_item">
								<div class="img_box" style = "width: 82px; height: 75px;cursor: pointer;">
									<img style = "width: 82px; height: 75px;"src="`+ image + `">
								</div>
								<div class="info_box" style = "padding-left: 10px;width: 153px; ">
									<div class="title">`+ title + `</div>
									<div class="sub_title">`+ cat2_Ko + `,` + cat3_Ko + `</div>
								</div>
								<div class="spot_to_inspot" onclick = "add_detail_box(this)" contentid="`+ contentid + `" title="` + title + `"cat3_Ko="` + cat3_Ko + `"cat2_Ko="` + cat2_Ko + `"cat2="` + cat2 + `" image="` + image + `" cat3="` + cat3 + `" mapx="` + mapx + `" mapy="` + mapy + `" style="cursor: pointer;margin-left:40px">
									<img src="https://www.earthtory.com/res/img/workspace/new/spot_to_inspot_a.png">
									
								</div>
							</div>
							`

								)

								$('#list_box').append(put_box);
							}



						}



					},
					error: function (xhr, status, error) {
						// 요청이 실패한 경우 실행할 코드
						console.error('Error:', error);
					}
				});


			}

		}



		var contenttype_id;
		var areaCode;
		function item_contenttype(e) {


			$('.list_cat_item').removeClass('on');
			$(e).addClass('on');

			contenttype_id = $(e).attr("contenttype_id");
			var location = $(".list_title_location").text().trim();
			$('#map_tag_select_box').text("태그 선택");
			$('#input_search').val(null);


			switch (location) {
				case "서울":
					areaCode = "1";
					break;
				case "인천":
					areaCode = "2";
					break;
				case "대전":
					areaCode = "3";
					break;
				case "대구":
					areaCode = "4";
					break;
				case "광주":
					areaCode = "5";
					break;
				case "부산":
					areaCode = "6";
					break;
				case "울산":
					areaCode = "7";
					break;
				default:    //제주도
					areaCode = "39";
					break;

			}

			$.ajax({
				url: '/plan/contenttype_id', // 요청을 보낼 URL
				method: "get", // HTTP 메서드 (GET, POST 등)
				data: {
					areaCode: areaCode,
					contenttype_id: contenttype_id,


				}, // 요청에 포함할 데이터 (선택 사항)
				success: function (list_box) {
					// 요청이 성공한 경우 실행할 코드
					$('#list_box').empty();
					$('#map_tag_select_sub_box').empty();

					var cat2_Ko;
					var cat3_Ko;
					for (var i = 0; i < list_box.length; i++) {
						var title = list_box[i].title;
						var image = list_box[i].firstimage;
						var cat2 = list_box[i].cat2;
						var cat3 = list_box[i].cat3;
						var mapx = list_box[i].mapx;
						var mapy = list_box[i].mapy;
						var contentid = list_box[i].contentid;
						var contenttypeid = list_box[i].contenttypeid;
						switch (contenttypeid) {
							case '39':
								cat2_Ko = food_change[cat2]
								cat3_Ko = food_change[cat3]
								break;
							case '38':
								cat2_Ko = shopping_change[cat2]
								cat3_Ko = shopping_change[cat3]
								break;

							case '12':
								cat2_Ko = tour_change[cat2]
								cat3_Ko = tour_change[cat3]
								break;

							case '14':
								cat2_Ko = culture_change[cat2]
								cat3_Ko = culture_change[cat3]
								break;

							default:
								cat2_Ko = house_change[cat2]
								cat3_Ko = house_change[cat3]
								break;


						}
						if (cat2_Ko != undefined) {
							var put_box = $(
								`<div class="day_spot_item">
									<div class="img_box" style = "width: 82px; height: 75px;cursor: pointer;">
										<img style = "width: 82px; height: 75px;"src="`+ image + `">
									</div>
									<div class="info_box" style = "padding-left: 10px;width: 153px; ">
										<div class="title">`+ title + `</div>
										<div class="sub_title">`+ cat2_Ko + `,` + cat3_Ko + `</div>
									</div>
									<div class="spot_to_inspot" onclick = "add_detail_box(this)" contentid="`+ contentid + `" title="` + title + `" image="` + image + `" cat3_Ko="` + cat3_Ko + `"cat2_Ko="` + cat2_Ko + `"cat2="` + cat2 + `" cat3="` + cat3 + `" mapx="` + mapx + `" mapy="` + mapy + `"  style="cursor: pointer;margin-left:40px">
										<img src="https://www.earthtory.com/res/img/workspace/new/spot_to_inspot_a.png">
										
									</div>
								</div>
								
								
								
								`




							)

							$('#list_box').append(put_box);
						}
					}








					var category;
					switch (contenttype_id) {
						case "39":
							category = $(
								`<div onclick="list_by_category(this)" class="item" cat3="A05020100" category="한식" >한식</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A05020200" category="서양식">서양식</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A05020300" category="일식">일식</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A05020400" category="중식" >중식</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A05020700" category="이색음식점">이색음식점</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A05020900" category="카페/전통찻집">카페/전통찻집</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A05021000" category="클럽">클럽</div>`
							);
							break;

						case "38":
							category = $(
								`<div onclick="list_by_category(this)" class="item" cat3="A04010100" category="5일장">5일장</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010200" category="상설시장">상설시장</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010300" category="백화점">백화점</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010400" category="면세점">면세점</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010500" category="대형마트">대형마트</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010600" category="전문매장">전문매장/상가</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010700" category="공예/공방">공예/공방</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04010900" category="특산물판매점">특산물판매점</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A04011000" category="사후면세점">사후면세점</div>`

							);
							break;

						case "12":
							category = $(
								`<div onclick="list_by_category(this)" class="item" cat3="A01010100" category="국립공원" >국립공원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010200" category="도립공원">도립공원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010300" category="군립공원">군립공원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010400" category="산">산</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010500" category="자연생태관광지">자연생태관광지</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010600" category="자연휴양림">자연휴양림</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010700" category="수목원">수목원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010800" category="폭포">폭포</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01010900" category="계곡">계곡</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011000" category="약수터">약수터</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011100" category="해안절경">해안절경</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011200" category="해수욕장">해수욕장</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011300" category="섬">섬</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011400" category="항구/포구">항구/포구</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011600" category="등대">등대</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011700" category="호수">호수</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011800" category="강">강</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01011900" category="동굴">동굴</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01020100" category="희귀동.식물">희귀동.식물</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A01020200" category="기암괴석">기암괴석</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010100" category="고궁">고궁</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010200" category="성">성</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010300" category="문">문</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010400" category="고택">고택</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010500" category="생가">생가</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010600" category="민속마을">민속마을</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010700" category="유적지/사적지">유적지/사적지</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010800" category="사찰">사찰</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02010900" category="종교성지">종교성지</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02011000" category="안보관광">안보관광</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020200" category="관광단지">관광단지</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020300" category="온천/욕장/스파">온천/욕장/스파</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020400" category="이색찜질방">이색찜질방</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020500" category="헬스투어">헬스투어</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020600" category="테마공원">테마공원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020700" category="공원">공원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02020800" category="유람선/잠수함관광">유람선/잠수함관광</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02030100" category="농.산.어촌 체험">농.산.어촌 체험</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02030200" category="전통체험">전통체험</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02030300" category="산사체험">산사체험</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02030400" category="이색체험">이색체험</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02030600" category="이색거리">이색거리</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02040400" category="발전소">발전소</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02040600" category="식음료">식음료</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02040900" category="전자-반도체">전자-반도체</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02041000" category="자동차">자동차</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02050100" category="다리/대교">다리/대교</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02050200" category="기념탑/기념비/전망대">기념탑/기념비/전망대</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02050300" category="분수">분수</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02050400" category="동상">동상</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02050500" category="터널">터널</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02050600" category="유명건물">유명건물</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02040800" category="기타">기타</div>
							 
							 `
							);
							break;

						case "14":
							category = $(
								`<div onclick="list_by_category(this)" class="item" cat3="A02060100" category="박물관">박물관</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060200" category="기념관">기념관</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060300" category="전시관">전시관</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060400" category="컨벤션센터">컨벤션센터</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060500" category="미술관/화랑">미술관/화랑</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060600" category="공연장">공연장</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060700" category="문화원">문화원</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02060900" category="도서관">도서관</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02061000" category="대형서점">대형서점</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02061100" category="문화전수시설">문화전수시설</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02061200" category="영화관">영화관</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02061300" category="어학당">어학당</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02061400" category="학교">학교</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02070100" category="문화관광축제">문화관광축제</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02070200" category="일반축제">일반축제</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080100" category="전통공연">전통공연</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080200" category="연극">연극</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080300" category="뮤지컬">뮤지컬</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080400" category="오페라">오페라</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080500" category="전시회">전시회</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080600" category="박람회">박람회</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080800" category="무용">무용</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02080900" category="클래식음악회">클래식음악회</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02081000" category="대중콘서트">대중콘서트</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02081100" category="영화">영화</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02081200" category="스포츠경기">스포츠경기</div>
							 <div onclick="list_by_category(this)" class="item" cat3="A02081300" category="기타행사">기타행사</div>
							 `

							);
							break;

						default:
							category = $(
								`<div onclick="list_by_category(this)" class="item" cat3="B02010100" category="5관광호텔">5관광호텔</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02010500" category="콘도">콘도</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02010600" category="유스호스텔">유스호스텔</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02010700" category="펜션">펜션</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02010900" category="모텔">모텔</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02011000" category="민박">민박</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02011100" category="게스트하우스">게스트하우스</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02011200" category="홈스테이">홈스테이</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02011600" category="한옥">한옥</div>
							 <div onclick="list_by_category(this)" class="item" cat3="B02011300" category="서비스드레지던스">서비스드레지던스</div>`

							);
							break;




					}
					$('#map_tag_select_sub_box').append(category);








				},
				error: function (xhr, status, error) {
					// 요청이 실패한 경우 실행할 코드
					console.error('Error:', error);
				}
			});

		}

		function open_sub_box(e) {

			if ($('#map_tag_select_sub_box').is(':empty')) {
				var empty = $(`<div>태그를 선택해 주세요</div>`)
				$('#map_tag_select_sub_box').append(empty);

			}


			var dataIsOpen = $(e).attr("data_is_open")

			if (dataIsOpen === "0") {

				$('#map_tag_select_box').css('border', '1px solid rgb(247, 135, 15)');
				$('#map_tag_select_sub_box').css('display', 'block');
				$(e).attr('data_is_open', '1');
			} else if (dataIsOpen === "1") {
				// data_is_open이 "1"일 때 수행할 작업
				// 예를 들어:
				console.log("너 요기 오제?")
				$('#map_tag_select_box').css('border', '1px solid #c8c8ca');
				$('#map_tag_select_sub_box').css('display', 'none');
				$(e).attr('data_is_open', '0');
			}


		}


		function list_by_category(e) {
			$('#map_tag_select_sub_box').css('display', 'none');
			$('#map_tag_select_box').css('border', '1px solid #c8c8ca');
			$('#map_tag_select_box').attr('data_is_open', '0');
			var cat3 = $(e).attr("cat3");
			var category = $(e).attr("category");
			$('#map_tag_select_box').text(category);

			console.log(cat3 + "cat3")
			console.log(areaCode + "areaCode")
			console.log(contenttype_id + "contenttype_id")
			$.ajax({
				url: '/plan/cat3', // 요청을 보낼 URL
				method: "get", // HTTP 메서드 (GET, POST 등)
				data: {
					cat3: cat3,
					areaCode: areaCode,
					contenttype_id: contenttype_id,



				}, // 요청에 포함할 데이터 (선택 사항)
				success: function (list_box) {
					// 요청이 성공한 경우 실행할 코드
					$('#list_box').empty();
					console.log("성공은 하나?")

					var cat2_Ko;
					var cat3_Ko;
					for (var i = 0; i < list_box.length; i++) {
						var title = list_box[i].title;
						var image = list_box[i].firstimage;
						var cat2 = list_box[i].cat2;
						var cat3 = list_box[i].cat3;
						var mapx = list_box[i].mapx;
						var mapy = list_box[i].mapy;
						var contentid = list_box[i].contentid;
						var contenttypeid = list_box[i].contenttypeid;
						switch (contenttypeid) {
							case '39':
								cat2_Ko = food_change[cat2]
								cat3_Ko = food_change[cat3]
								break;
							case '38':
								cat2_Ko = shopping_change[cat2]
								cat3_Ko = shopping_change[cat3]
								break;

							case '12':
								cat2_Ko = tour_change[cat2]
								cat3_Ko = tour_change[cat3]
								break;

							case '14':
								cat2_Ko = culture_change[cat2]
								cat3_Ko = culture_change[cat3]
								break;

							default:
								cat2_Ko = house_change[cat2]
								cat3_Ko = house_change[cat3]
								break;


						}
						if (cat2_Ko != undefined) {
							var put_box = $(
								`<div class="day_spot_item" ">
								<div class="img_box" style = "width: 82px; height: 75px;position: relative;cursor: pointer;">
									<img style = "width: 82px; height: 75px;"src="`+ image + `">
								</div>
								<div class="info_box" style = "padding-left: 10px;width: 153px; ">
									<div class="title">`+ title + `</div>
									<div class="sub_title">`+ cat2_Ko + `,` + cat3_Ko + `</div>
								</div>
								<div class="spot_to_inspot" onclick = "add_detail_box(this)"contentid="`+ contentid + `"  title="` + title + `" image="` + image + `" cat3_Ko="` + cat3_Ko + `"cat2_Ko="` + cat2_Ko + `"cat2="` + cat2 + `"  cat3="` + cat3 + `" mapx="` + mapx + `" mapy="` + mapy + `"  style="cursor: pointer;margin-left:40px">
									<img src="https://www.earthtory.com/res/img/workspace/new/spot_to_inspot_a.png">
									
								</div>
							</div>`
							)

							$('#list_box').append(put_box);
						}
					}

				},
				error: function (xhr, status, error) {
					// 요청이 실패한 경우 실행할 코드
					console.error('Error:', error);
				}
			});


		}


		function search_keyword(e) {
			var keyword = $(e).val();

			var cat2_Ko;
			var cat3_Ko;
			$.ajax({
				url: '/plan/searchKeyword', // 요청을 보낼 URL
				method: "get", // HTTP 메서드 (GET, POST 등)
				data: {
					keyword: keyword,



				}, // 요청에 포함할 데이터 (선택 사항)
				success: function (list_box) {
					// 요청이 성공한 경우 실행할 코드
					$('#list_box').empty();


					for (var i = 0; i < list_box.length; i++) {
						var title = list_box[i].title;
						var image = list_box[i].firstimage;
						var cat2 = list_box[i].cat2;
						var cat3 = list_box[i].cat3;
						var mapx = list_box[i].mapx;
						var mapy = list_box[i].mapy;
						var contentid = list_box[i].contentid;
						var contenttypeid = list_box[i].contenttypeid;
						switch (contenttypeid) {
							case '39':
								cat2_Ko = food_change[cat2]
								cat3_Ko = food_change[cat3]
								break;
							case '38':
								cat2_Ko = shopping_change[cat2]
								cat3_Ko = shopping_change[cat3]
								break;

							case '12':
								cat2_Ko = tour_change[cat2]
								cat3_Ko = tour_change[cat3]
								break;

							case '14':
								cat2_Ko = culture_change[cat2]
								cat3_Ko = culture_change[cat3]
								break;

							default:
								cat2_Ko = house_change[cat2]
								cat3_Ko = house_change[cat3]
								break;


						}
						if (cat2_Ko != undefined) {
							var put_box = $(
								`<div class="day_spot_item" ">
								<div class="img_box" style = "width: 82px; height: 75px;position: relative;cursor: pointer;">
									<img style = "width: 82px; height: 75px;"src="`+ image + `">
								</div>
								<div class="info_box" style = "padding-left: 10px;width: 153px; ">
									<div class="title">`+ title + `</div>
									<div class="sub_title">`+ cat2_Ko + `,` + cat3_Ko + `</div>
								</div>
								<div class="spot_to_inspot" onclick = "add_detail_box(this)"contentid="`+ contentid + `"  title="` + title + `" cat3_Ko="` + cat3_Ko + `"cat2_Ko="` + cat2_Ko + `"cat2="` + cat2 + `"  image="` + image + `" cat3="` + cat3 + `" mapx="` + mapx + `" mapy="` + mapy + `"  style="cursor: pointer;margin-left:40px">
									<img src="https://www.earthtory.com/res/img/workspace/new/spot_to_inspot_a.png">
									
								</div>
							</div>`
							)

							$('#list_box').append(put_box);
						}
					}

				},
				error: function (xhr, status, error) {
					// 요청이 실패한 경우 실행할 코드
				}
			})
		}


		function search_keyword_check(e) {
			var keyword = $(e).val();
			if (keyword === null || keyword === "") {
				$('.on').click();

			}

		}










		function detail_view(e) {
			var contentid = $(e).attr("contentid");
			var title = $(e).attr("title_real");
			$('#detail_view_full_box').empty();
			$("#detail_view_full_box").css('display', 'flex');



			$.ajax({
				url: '/plan/detail', // 요청을 보낼 URL
				method: "get", // HTTP 메서드 (GET, POST 등)
				data: {
					contentid: contentid,



				}, // 요청에 포함할 데이터 (선택 사항)
				success: function (box) {
					// 요청이 성공한 경우 실행할 코드



					var title = box.title;
					var image = box.firstimage;
					var cat2 = box.cat2;
					var cat3 = box.cat3;
					var mapx = box.mapx;
					var mapy = box.mapy;
					var addr1 = box.addr1;
					var addr2 = box.addr2;
					var homepage = box.homepage;
					var contentid = box.contentid;
					var overview = box.overview;
					//detail_close_btn right - 40px로 바꾸기
					var detail_view = $(
						`<div class="spot_title" style="text-align: center; width: 100%; border-bottom: 1px solid black; line-height: 50px;font-size: 18px;font-weight: bold;">` + title + `</div>
						<div id="detail_close_btn" onclick="detail_close()"   style="left:401px; width: 40px;height: 40px; position: absolute;top: 10px;right: 0px;background: url(https://www.earthtory.com/res/img/map/info_close_btn.png);cursor: pointer;"></div>
						<div class="spot_img" style="width: 400px;height: 182px;position: relative;"><img src="`+ image + `"    style="width: 400px;height: 182px"></div>
						<div class="detail_content">
							<div class="info_first" style="overflow-y: auto;max-height: 826px;display: flex;flex-direction: column;">
								<div class="in_full_box" style="display: flex;padding: 15px;">
									<div class="info_memo" style="display: flex;flex-direction: column;width: 100%;padding: 10px;text-align: center;background: #f7f7f7;">
										<div style="font-size:15px;color:#363636;font-weight:bold;text-align:left;padding-bottom:10px;padding-left:8px;">예산</div>
										<div style="padding-left:10px;padding-bottom:15px;">
											<div class="budget_currency" style=" float: left; width: 70px;height: 31px;border: solid #c8c8ca 1px;line-height: 31px;margin: 0 auto;margin-top: 0px;padding-left: 15px;font-size: 13px;color: #808080;text-align: left;cursor: pointer;">KRW</div>
											<div class="set_money" style="float: left;height: 32.757;width: 205.438;"><input type="text" class="budget_input value="0" onkeyup="" style="height: 100%;"></div>
										</div>
										<div style="font-size:15px;color:#363636;font-weight:bold;text-align:left;padding-bottom:10px;padding-left:8px;">메모</div>
										<textarea id="memo_input" data_set_day="" data_set_order="" style="width: 290px;height: 60px;border: solid #c8c8ca 1px;padding: 10px;font-family: 'nanum';font-size: 12px;line-height: 20px;margin-left: 12px;"></textarea>
									
									</div>
								</div>
								
								<div class="in_full_box" style="line-height:22px;font-size:11px;color:#808080;padding-bottom:20px;font-size:13px;">
									<img src="https://www.earthtory.com/res/img/workspace/new/tip_desc_icon.png">`+ overview + `
								</div>
								<div class="infomation" style="width: 100%;display: flex;">
									<div style="width:100%;padding:15px;border:solid #d4d4d4 1px;">
										<div style="color:#808080;font-size:13px;padding-left:20px;background:url('https://www.earthtory.com/res/img/workspace/new/addr_desc_icon.png') no-repeat 2px 2px;line-height:16px;padding-bottom:10px;">`+ addr1 + ` ` + addr2 + `</div>
										<div class="sub_title" style="float: left; padding-top: 5px;padding-bottom: 10px;width: 93px;font-size: 12px;color: #555555;">카테고리</div>
										<div class="sub_info" style=" float: left; padding-top: 5px;padding-bottom: 10px;font-size: 12px;color: #808080;width: 190px;line-height: 18px;">`+ cat2 + ` ` + cat3 + `</div>
									</div>
								</div>
								<div class="sub_desc" style="    padding-top: 20px;font-size: 13px;color: #808080;line-height: 24px;padding-bottom: 15px;"></div>
							
								<div class="info_third" style="padding-top:30px;display: flex;flex-direction: column;">
									<div style="font-size:15px;color:#363636;font-weight:bold;padding-bottom:10px;padding-left:20px;font-weight: bold;">블로그</div>
									
								</div>
							</div>
							
						</div>
						`
					)

					$('#detail_view_full_box').append(detail_view);







					$.ajax({
						url: '/plan/search_blog', // 요청을 보낼 URL
						method: "get", // HTTP 메서드 (GET, POST 등)
						data: {

							title, title,


						}, // 요청에 포함할 데이터 (선택 사항)
						success: function (response) {
							// 요청이 성공한 경우 실행할 코드


							var maxLength = 20;
							for (var i = 0; i < response.length; i++) {
								var title = response[i].title;
								var description = response[i].description;
								var trimmedDescription = description.length > maxLength ? description.substring(0, maxLength) + "..." : description;


								var link = response[i].link;
								var blog = $(
									`<a href="` + link + `" target="_blank">
								<div class="in_full_box">
									<div class="blog_item" style="overflow-y: auto;padding: 15px 15px 0;border-bottom: 1px solid #dbdbdb">
										<div class="blog_title" style="font-size:15px;color:#1a7ad9;padding-bottom:5px;font-weight:bold;line-height:20px;">`+ title + `</div>
										<div class="blog_description" style=" text-decoration: none !important; font-size: 12px;color: #363636;line-height: 20px;">`+ description + `</div>
									</div>
								</div>	
							</a>`

								)
								$('.info_third').append(blog);
							}




						},
						error: function (xhr, status, error) {
							// 요청이 실패한 경우 실행할 코드
						}
					})










				},
				error: function (xhr, status, error) {
					// 요청이 실패한 경우 실행할 코드
				}
			})









		}


		function detail_close() {
			$('#detail_view_full_box').css("display", "none");
		}









		function openKakaoMap(e) {
			var lat = $(e).attr("mapx");
			var lng = $(e).attr("mapy");
			var ex_lat = pre_previousMarker.getPosition().getLat();
			var ex_lng = pre_previousMarker.getPosition().getLng();


			var pre_title = $(e).attr("pre_title");
			var title = $(e).attr("title");
			var target = 'car';


			//37.49870191290001
			//127.0285433827
			// WCONGNAMUL, CONGNAMUL
			var REST_API_KEY = '653207f7b82a5728fc88da0d8c668496';
			var lat_change;
			var lng_change;
			var ex_lng_change;
			var ex_lat_change;
			var input_coord = 'WGS84';
			var output_coord = 'CONGNAMUL';

			$.ajax({
				url: 'https://dapi.kakao.com/v2/local/geo/transcoord.json',
				type: 'GET',
				data: {
					x: ex_lng,
					y: ex_lat,
					input_coord: input_coord,
					output_coord: output_coord
				},
				headers: {
					'Authorization': 'KakaoAK ' + REST_API_KEY
				},
				success: function (response) {
					ex_lat_change = response.documents[0].x;
					ex_lng_change = response.documents[0].y;



					$.ajax({
						url: 'https://dapi.kakao.com/v2/local/geo/transcoord.json',
						type: 'GET',
						data: {
							x: lat,
							y: lng,
							input_coord: input_coord,
							output_coord: output_coord
						},
						headers: {
							'Authorization': 'KakaoAK ' + REST_API_KEY
						},
						success: function (responses) {
							lat_change = responses.documents[0].x;
							lng_change = responses.documents[0].y;

							var url = 'https://map.kakao.com/?map_type=TYPE_MAP&target=' + target +
								'&rt=' + ex_lat_change + '%2C' + ex_lng_change + '%2C' + lat_change + '%2C' + lng_change +
								'&rt1=' + pre_title + '&rt2=' + title + '&rtIds=,8430129';


							var width = 600; // 폭
							var height = 400; // 높이
							var options = 'width=' + width + ',height=' + height;

							window.open(url, '_blank', options);



						},
						error: function (xhr, status, error) {
							console.error(xhr.responseText);
							// 오류를 처리하는 코드를 여기에 추가하세요
							$('#result').html('오류 발생: ' + error);
						}
					});












				},
				error: function (xhr, status, error) {
					console.error(xhr.responseText);
					// 오류를 처리하는 코드를 여기에 추가하세요
					$('#result').html('오류 발생: ' + error);
				}
			});
















			//var startCoords = convertToKATEC(parseFloat(ex_lng), parseFloat(ex_lat));
			//var endCoords = convertToKATEC(parseFloat(lat), parseFloat(lng));

			//			var geocoder = new kakao.maps.services.Geocoder();
			//			geocoder.coord2Address(lat, lng, function (result, status) {
			//				if (status === kakao.maps.services.Status.OK) {
			//					var des_address = result[0].address.address_name;
			//					console.log('주소: ' + des_address);
			//				} else {
			//					console.error('좌표로 주소를 가져오는 데 실패했습니다.');
			//				}
			//			});
			//			geocoder.coord2Address(ex_lng, ex_lat, function (result, status) {
			//				if (status === kakao.maps.services.Status.OK) {
			//					pre_address = result[0].address.address_name;
			//					console.log('주소: ' + pre_address);
			//				} else {
			//				console.error('좌표로 주소를 가져오는 데 실패했습니다.');
			//			}
			//	});




			//	console.log("url check : " + url);

			//var kakaoMapUrl = 'https://map.kakao.com/?sName='+pre_title+'&eName='+title+'&sx=' + ex_lat + '&sy=' + ex_lng + '&ex=' + lng + '&ey=' + lat + '&path=0&by=CAR';

			//var test_url = 'https://map.kakao.com/link/to/' + title + ',' + lng + ',' + lat + '';


			var width = 600; // 폭
			var height = 400; // 높이
			var options = 'width=' + width + ',height=' + height;

			//window.open(url, '_blank', options);

			/*		var test_window =
			
						var interval = setInterval(function () {
							if (test_window && test_window.document.readyState === 'complete') {
								clearInterval(interval); // 인터벌을 중지합니다.
								// 새 창의 로드가 완료되면 실행될 함수를 호출합니다.
								onLoad();
							}
						}, 1000); // 1초마다 확인합니다.
			
						function onLoad() {
							// 새 창이 로드되었을 때 실행될 함수
							alert("새 창이 로드되었습니다.");
			
							// 새 창의 DOM에서 검색창 요소를 찾아서 값 입력
							var inputElement = $(test_window.document).find('#info.route.waypointSuggest.input0'); // 변경하고자 하는 입력 필드의 ID를 지정합니다.
							if (inputElement.length > 0) {
								inputElement.val(pre_title); // 변경하고자 하는 값을 설정합니다.
							}
						}*/

		}





		function get_address_by_xy() {
			var geocoder = new kakao.maps.services.Geocoder();
			geocoder.coord2Address(lat, lng, function (result, status) {
				if (status === kakao.maps.services.Status.OK) {
					var des_address = result[0].address.address_name;
				} else {
					console.error('좌표로 주소를 가져오는 데 실패했습니다.');
				}
			});
			geocoder.coord2Address(ex_lng, ex_lat, function (result, status) {
				if (status === kakao.maps.services.Status.OK) {
					pre_address = result[0].address.address_name;
				} else {
					console.error('좌표로 주소를 가져오는 데 실패했습니다.');
				}
			});
		}






		var previousMarker = null; // 이전 마커
		var pre_previousMarker = null;
		var totalDistance = 0; // 누적 거리
		var markers = []; // 마커를 담을 배열
		var lines = []; // 폴리라인을 담을 배열

		function addMarker(latlng) {

			var marker = new kakao.maps.Marker({
				position: latlng
			});
			marker.setMap(map);
			markers.push(marker);

			if (previousMarker !== null) {
				// 이전 마커와 새로운 마커 사이의 거리 계산
				var distance = getLineDistance(previousMarker.getPosition(), marker.getPosition());
				var distancecheck = distance.toFixed(2) + 'km';

				totalDistance += distance; // 누적 거리 업데이트

				// 새로운 마커와 이전 마커를 연결하는 폴리라인을 그립니다.
				var linePath = [markers[markers.length - 2].getPosition(), markers[markers.length - 1].getPosition()];
				var polyline = new kakao.maps.Polyline({
					path: linePath,
					strokeWeight: 3,
					strokeColor: '#FF0000', // 핑크색과 유사한 빨간색 (RGBA 형식)
					strokeOpacity: 0.7,
					strokeStyle: 'solid'
				});
				polyline.setMap(map);
				lines.push(polyline);
			}
			pre_previousMarker = previousMarker;
			previousMarker = marker; // 현재 마커를 이전 마커로 저장
			return distancecheck;
		}

		function getLineDistance(point1, point2) {
			var lat1 = point1.getLat(), lon1 = point1.getLng(); // 첫 번째 지점의 위도와 경도
			var lat2 = point2.getLat(), lon2 = point2.getLng(); // 두 번째 지점의 위도와 경도

			var R = 6371; // 지구 반경 (단위: km)
			var dLat = (lat2 - lat1) * Math.PI / 180;
			var dLon = (lon2 - lon1) * Math.PI / 180;
			var a =
				Math.sin(dLat / 2) * Math.sin(dLat / 2) +
				Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
				Math.sin(dLon / 2) * Math.sin(dLon / 2);
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
			var distance = R * c; // 거리 (단위: km)
			return distance;
		}



		function loc_optimize_btn() {






			var total_children = $('#schedule_detail_box > .day_spot_item').length;

			if (total_children < 4) {
				alert("경로 최적화는 하루일정에 4개 이상의 장소가 포함되어야 합니다")
				return;

			}

			$(".in_modal_full_frame").css('display', 'block');
			$(".modal_for_short").css('display', 'block');

			var check_child_N = 0;
			$('#opti_start_point_box').empty();
			$('#opti_end_point_box').empty();
			$('#schedule_detail_box > .day_spot_item').each(function (index) {
				check_child_N++;
				var title = $(this).attr('title');
				var mapx = $(this).attr('mapx');
				var mapy = $(this).attr('mapy');


				if (index === 0) {
					// 마지막 자식 요소에 대한 처리를 수행합니다.
					$("#opti_start_point").text(title);
					$("#opti_start_point").attr("title", title);
					$("#opti_start_point").attr("mapx", mapx);
					$("#opti_start_point").attr("mapy", mapy);
				} else if (index === total_children - 1) {
					// 마지막 자식 요소에 대한 처리를 수행합니다.
					$("#opti_end_point").text(title);
					$("#opti_end_point").attr("title", title);
					$("#opti_end_point").attr("mapx", mapx);
					$("#opti_end_point").attr("mapy", mapy);
				}

				var add = $(
					`<div class="item" onclick ="change_start(this)" style="height: 18px;cursor: pointer;padding-left: 25px;line-height: 18px;margin-bottom: 7px" title="` + title + `" mapx="` + mapx + `" mapy="` + mapy + `" data="` + check_child_N + `">` + title + `</div>`
				)

				$("#opti_start_point_box").append(add);

				var add2 = $(
					`<div class="item" onclick ="change_end(this)" style="height: 18px;cursor: pointer;padding-left: 25px;line-height: 18px;margin-bottom: 7px" title="` + title + `" mapx="` + mapx + `" mapy="` + mapy + `"  data="` + check_child_N + `">` + title + `</div>`
				)
				$("#opti_end_point_box").append(add2);






			});





		}


		function change_start(e) {
			var title = $(e).attr("title")
			var mapx = $(e).attr("mapx")
			var mapy = $(e).attr("mapy")




			$("#opti_start_point").text(title);
			$("#opti_start_point").attr("title", title);
			$("#opti_start_point").attr("mapx", mapx);
			$("#opti_start_point").attr("mapy", mapy);

			$('#opti_start_point_box').css('display', 'none');
			$("#opti_start_point").attr('data_is_open', '0');

		}

		function change_end(e) {
			var title = $(e).attr("title")
			var mapx = $(e).attr("mapx")
			var mapy = $(e).attr("mapy")

			$("#opti_end_point").text(title);
			$("#opti_end_point").attr("title", title);
			$("#opti_end_point").attr("mapx", mapx);
			$("#opti_end_point").attr("mapy", mapy);


			$('#opti_end_point_box').css('display', 'none');
			$("#opti_end_point").attr('data_is_open', '0');

		}


		function modal_close() {

			$(".in_modal_full_frame").css('display', 'none');
			$(".modal_for_short").css('display', 'none');

		}


		function opti_start_open(e) {

			var dataIsOpen = $(e).attr("data_is_open")

			if (dataIsOpen === "0") {

				$('#opti_start_point_box').css('display', 'block');
				$(e).attr('data_is_open', '1');
			} else if (dataIsOpen === "1") {
				// data_is_open이 "1"일 때 수행할 작업
				// 예를 들어:
				$('#opti_start_point_box').css('display', 'none');
				$(e).attr('data_is_open', '0');
			}

		}
		function opti_end_open(e) {

			var dataIsOpen = $(e).attr("data_is_open")

			if (dataIsOpen === "0") {

				$('#opti_end_point_box').css('display', 'block');
				$(e).attr('data_is_open', '1');
			} else if (dataIsOpen === "1") {
				// data_is_open이 "1"일 때 수행할 작업
				// 예를 들어:
				$('#opti_end_point_box').css('display', 'none');
				$(e).attr('data_is_open', '0');
			}

		}


		function optimize_route_go() {
			var dat_before_titles = [];
			var start_title = $("#opti_start_point").attr("title")
			var start_mapx = $("#opti_start_point").attr("mapx")
			var start_mapy = $("#opti_start_point").attr("mapy")

			var end_title = $("#opti_end_point").attr("title")
			var end_mapx = $("#opti_end_point").attr("mapx")
			var end_mapy = $("#opti_end_point").attr("mapx")


			$('#schedule_detail_box > .day_spot_item').each(function () {
				dat_before_titles.push($(this).attr('title'));
				var title = $(this).attr('title');
				var mapx = $(this).attr('mapx');
				var mapy = $(this).attr('mapy');
			});










			// 예시: 시작점과 끝점의 정보, 그리고 여러 지점들의 정보를 사용하여 최적의 경로를 계산합니다.
			const startPoint = {title: start_title, latitude: start_mapy, longitude: start_mapx}; // 시작점 정보
			const endPoint = {title: end_title, latitude: end_mapy, longitude: end_mapx}; // 끝점 정보
			var middlePoints = [];

			$("#opti_start_point_box .item").each(function () {
				var title = $(this).attr("title");
				var mapx = $(this).attr("mapx");
				var mapy = $(this).attr("mapy");
				if (title !== start_title && title !== end_title) {
					middlePoints.push({title: title, latitude: mapy, longitude: mapx});
				}
			});

			const optimizedPath = optimizePath(startPoint, endPoint, middlePoints);
			console.log('최적화된 경로:', optimizedPath);




		}



		function getLineDistancess(lat1, lon1, lat2, lon2) {

			var R = 6371; // 지구 반경 (단위: km)
			var dLat = (lat2 - lat1) * Math.PI / 180;
			var dLon = (lon2 - lon1) * Math.PI / 180;
			var a =
				Math.sin(dLat / 2) * Math.sin(dLat / 2) +
				Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
				Math.sin(dLon / 2) * Math.sin(dLon / 2);
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
			var distance = R * c; // 거리 (단위: km)
			return distance;
		}






		// 시작점과 끝점 사이의 거리를 계산하여 가장 가까운 지점을 찾습니다.
		function findClosestPoint(startPoint, endPoint, points) {
			let minDistanceToStart = Infinity;
			let minDistanceToEnd = Infinity;
			let closestStartPoint = null;
			let closestEndPoint = null;

			points.forEach(function (point, index) {
				const distanceToStart = getLineDistancess(startPoint.latitude, startPoint.longitude, point.latitude, point.longitude);
				const distanceToEnd = getLineDistancess(endPoint.latitude, endPoint.longitude, point.latitude, point.longitude);

				if (distanceToStart < minDistanceToStart) {
					minDistanceToStart = distanceToStart;
					closestStartPoint = {title: point.title, latitude: point.latitude, longitude: point.longitude};
				}

				if (distanceToEnd < minDistanceToEnd) {
					minDistanceToEnd = distanceToEnd;
					closestEndPoint = {title: point.title, latitude: point.latitude, longitude: point.longitude};
				}
			});

			return [closestStartPoint, closestEndPoint];
		}

		function optimizePath(startPoint, endPoint, middlePoints) {
			// 최적의 경로를 구성합니다.
			const optimizedPath = {};
			optimizedPath[startPoint.title] = startPoint;

			// 중간 경유지를 추가합니다.
			middlePoints.forEach((middlePoint, index) => {
				optimizedPath[`Middle Point ${middlePoint.title}`] = {latitude: middlePoint.latitude, longitude: middlePoint.longitude};
			});

			optimizedPath[endPoint.title] = endPoint;

			return optimizedPath;
		}


		function focus_change(e) {

			$('.left_day_set_on').removeClass('left_day_set_on');
			$(e).addClass('left_day_set_on');

		}




	</script>


</body>

</html>